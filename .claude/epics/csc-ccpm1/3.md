# Task 002: Mock Services Framework

---
epic: csc-ccpm1
task_id: 002
title: Mock Services Framework
description: Create mock services for Veeva Vault, SFMC, S3, Salesforce CDP with realistic response simulation
priority: high
status: open
assignee:
created_at: 2025-09-24T09:47:25Z
updated_at: 2025-09-24T09:47:25Z
estimated_hours: 20
actual_hours: 0
parallel: true
depends_on: []
blocks: []
tags: [mock-services, testing, infrastructure]
---

## Overview
Develop a comprehensive mock services framework to simulate external systems including Veeva Vault, Salesforce Marketing Cloud (SFMC), AWS S3, and Salesforce CDP. This framework will enable development and testing without dependencies on live external services.

## Acceptance Criteria

### Veeva Vault Mock Service
- [ ] Implement RESTful API endpoints matching Veeva Vault API specification
- [ ] Mock document management operations (upload, download, metadata)
- [ ] Simulate authentication and session management
- [ ] Provide configurable response delays and error scenarios
- [ ] Support document lifecycle state transitions

### Salesforce Marketing Cloud (SFMC) Mock Service
- [ ] Mock email campaign management APIs
- [ ] Simulate data extension operations
- [ ] Implement journey and automation endpoints
- [ ] Mock subscriber and list management
- [ ] Provide realistic response data structures

### AWS S3 Mock Service
- [ ] Implement S3-compatible API endpoints
- [ ] Support bucket operations (create, list, delete)
- [ ] Mock object operations (put, get, delete, list)
- [ ] Simulate multipart upload functionality
- [ ] Implement presigned URL generation

### Salesforce CDP Mock Service
- [ ] Mock customer profile and identity resolution APIs
- [ ] Simulate data stream ingestion endpoints
- [ ] Implement calculated insights and segments
- [ ] Mock real-time interaction APIs
- [ ] Provide customer journey tracking simulation

### Framework Features
- [ ] Configurable response scenarios (success, error, timeout)
- [ ] Request/response logging and monitoring
- [ ] Data persistence for stateful operations
- [ ] Performance simulation with realistic latencies
- [ ] Admin interface for service management

## Technical Requirements

### Architecture
- FastAPI or Flask-based REST API services
- In-memory or SQLite database for mock data persistence
- Docker containerization for easy deployment
- Swagger/OpenAPI documentation for all endpoints
- Configurable service behavior via environment variables

### Response Simulation
- Realistic data generation using Faker library
- Configurable error rates and response times
- State management for complex workflows
- Request validation matching real service schemas
- Response caching for performance testing

### Monitoring and Debugging
- Request/response logging with correlation IDs
- Metrics collection for service usage
- Health check endpoints for service monitoring
- Debug mode with detailed error information
- Request replay functionality for testing

## Implementation Details

### Service Structure
```
mock_services/
├── veeva_vault/
│   ├── __init__.py
│   ├── api.py
│   ├── models.py
│   ├── data.py
│   └── config.py
├── sfmc/
│   ├── __init__.py
│   ├── api.py
│   ├── models.py
│   ├── data.py
│   └── config.py
├── s3/
│   ├── __init__.py
│   ├── api.py
│   ├── storage.py
│   └── config.py
├── salesforce_cdp/
│   ├── __init__.py
│   ├── api.py
│   ├── models.py
│   ├── data.py
│   └── config.py
├── common/
│   ├── __init__.py
│   ├── base_service.py
│   ├── auth.py
│   ├── middleware.py
│   └── utils.py
└── docker-compose.yml
```

### Key Endpoints by Service

#### Veeva Vault
- `/api/v21.1/auth` - Authentication
- `/api/v21.1/objects/documents` - Document operations
- `/api/v21.1/metadata` - Metadata management
- `/api/v21.1/query` - VQL queries

#### SFMC
- `/v2/token` - OAuth token endpoint
- `/data/v1/customobjectdata/contacts` - Contact management
- `/messaging/v1/email/messages` - Email operations
- `/automation/v1/automations` - Automation management

#### S3
- `/{bucket}` - Bucket operations
- `/{bucket}/{key}` - Object operations
- `/` - Service root and bucket listing
- Presigned URL generation endpoints

#### Salesforce CDP
- `/services/data/v1/customer` - Customer profiles
- `/services/data/v1/segments` - Segment management
- `/services/data/v1/calculated-insights` - Insights API
- `/services/data/v1/interaction` - Real-time interactions

### Configuration Options
- Response delay simulation (min/max milliseconds)
- Error rate configuration (percentage)
- Authentication bypass modes
- Data generation seeds for consistent testing
- Service availability toggles

## Testing Requirements
- [ ] Unit tests for each mock service endpoint
- [ ] Integration tests with realistic client scenarios
- [ ] Performance tests under load conditions
- [ ] Error scenario validation tests
- [ ] Configuration parameter validation tests

### Test Data Management
- Predefined test datasets for consistent testing
- Data reset functionality between test runs
- Custom data loading capabilities
- State validation for complex workflows

## Documentation Requirements
- [ ] API documentation for each mock service
- [ ] Configuration guide for different scenarios
- [ ] Development setup instructions
- [ ] Client integration examples

## Success Metrics
- All mock services respond within 100ms for basic operations
- 99.9% uptime during development and testing
- Complete API coverage for required operations
- Zero configuration drift between mock and real services
- Successful integration with all client applications

## Notes
- Mock services should maintain API compatibility with real services
- Focus on realistic behavior over complete feature coverage
- Ensure easy switching between mock and real services
- Consider using service virtualization tools for complex scenarios
- Implement comprehensive logging for debugging client integration issues
